@using CleanArchitecture.Blazor.Application.Common.Interfaces.MultiTenant
@using CleanArchitecture.Blazor.Application.Features.Identity.Dto
@using ResizeMode = SixLabors.ImageSharp.Processing.ResizeMode
@using Severity = MudBlazor.Severity
@using Size = SixLabors.ImageSharp.Size
@using SixLabors.ImageSharp.Formats.Png
@using SixLabors.ImageSharp.Processing
@using Image = SixLabors.ImageSharp.Image
@using Color = MudBlazor.Color
@inherits MudComponentBase
@inject IStringLocalizer<Users> L


<MudForm Model="@Model" @ref="@_form" Validation="@(_modelValidator.ValidateValue)">
    <input For="@(() => Model.Id)" @bind-value="Model.Id" type="hidden"/>
    <input For="@(() => Model.ProfilePictureDataUrl)" @bind-value="Model.ProfilePictureDataUrl" type="hidden"/>
    <InputFile id="UploadPhoto" OnChange="UploadPhoto" hidden accept=".jpg, .jpeg, .png"/>
    <MudGrid>
        <MudItem sm="12">
            <div class="d-flex justify-center">

                @if (string.IsNullOrEmpty(Model.ProfilePictureDataUrl))
                {
                    <MudAvatar Style="height:128px; width:128px; font-size:2rem;">@Model.UserName.ToUpper().FirstOrDefault()</MudAvatar>
                }
                else
                {
                    <MudAvatar Style="height:128px; width:128px; font-size:2rem;">
                        <MudImage Src="@Model.ProfilePictureDataUrl"></MudImage>
                    </MudAvatar>
                }
                <MudTooltip Text="@L["Click upload a photo."]">
                    <MudIconButton HtmlTag="label"
                                   Color="Color.Info"
                                   Icon="@Icons.Material.Filled.PhotoCamera"
                                   for="UploadPhoto">
                    </MudIconButton>
                </MudTooltip>
            </div>
        </MudItem>
        <MudItem sm="6" xs="12">
            <MudSelect For="@(() => Model.TenantId)"
                       T="string"
                       Label="@L["Select Tenant"]"
                       Text="@Model.TenantName"
                       Required="true"
                       RequiredError="@L["Tenant is required."]"
                       Value="@Model.TenantId"
                       ValueChanged="TenantSelectChanged">
                @foreach (var item in TenantsService.DataSource)
                {
                    <MudSelectItem T="string" Value="@item.Id">@item.Name</MudSelectItem>
                }
            </MudSelect>
        </MudItem>
        <MudItem xs="12" sm="6">
            <MudTextField For="@(() => Model.Provider)" @bind-Value="Model.Provider" Label="@L["Provider"]" Variant="Variant.Text"></MudTextField>
        </MudItem>

        <MudItem xs="12" sm="6">
            <MudTextField For="@(() => Model.UserName)" @bind-Value="Model.UserName" Label="@L["User Name"]" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" sm="6">
            <PickSuperiorIdAutocomplete For="@(() => Model.SuperiorId)"
                                        OwnerName="@Model.UserName"
                                        Clearable="true"
                                        Label="@L["Select Superior"]"
                                        @bind-Value="@Model.SuperiorId">
            </PickSuperiorIdAutocomplete>

        </MudItem>
        @if (string.IsNullOrEmpty(Model.Id))
        {
            <MudItem xs="12" sm="6">
                <MudPasswordField Immediate="true"
                                  Label="@L["Password"]"
                                  @bind-Value="Model.Password"
                                  For="@(() => Model.Password)"
                                  Variant="Variant.Text"
                                  PasswordMode="true"
                                  Required="true"
                                  RequiredError="@L["password is required!"]"
                                  Class="mt-4"/>
            </MudItem>
            <MudItem xs="12" sm="6">
                <MudPasswordField Immediate="true"
                                  Label="@L["Confirm Password"]"
                                  @bind-Value="Model.ConfirmPassword"
                                  For="@(() => Model.ConfirmPassword)"
                                  Variant="Variant.Text"
                                  PasswordMode="true"
                                  Required="true"
                                  RequiredError="@L["confrm password is required!"]"
                                  Class="mt-4"/>
            </MudItem>
        }
        <MudItem xs="12" sm="6">
            <MudTextField For="@(() => Model.DisplayName)" @bind-Value="Model.DisplayName" Label="@L["Display Name"]" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" sm="6">
            <MudTextField For="@(() => Model.Email)" @bind-Value="Model.Email" Label="@L["E-mail"]" Variant="Variant.Text"></MudTextField>
        </MudItem>
        <MudItem xs="12" sm="6">
            <MudTextField For="@(() => Model.PhoneNumber)" @bind-Value="Model.PhoneNumber" Label="@L["Phone Number"]" Variant="Variant.Text"></MudTextField>
        </MudItem>


        <MudItem xs="12" sm="6">
            <MudText Typo="Typo.caption">@L["Status"]</MudText>
            <div class="d-fex">
                <MudCheckBox For="@(() => Model.IsActive)" T="bool" @bind-Checked="Model.IsActive" Label="@L["Is Active"]"></MudCheckBox>
            </div>
        </MudItem>
        <MudItem xs="12" sm="12">
            <MudText Typo="Typo.caption">@L["Assign Roles"]</MudText>
            <MudGrid Class="mt-1">
                @for (var i = 0; i < Roles.Count; i++)
                {
                    var x = i;
                    <MudItem xs="6" sm="6" Class="py-0 my=0">
                        <MudCheckBox T="bool" Checked="@Roles[x].Value" Label="@Roles[x].Key" CheckedChanged="@(s => Roles[x].Value = (bool)s)"></MudCheckBox>
                    </MudItem>
                }
            </MudGrid>
        </MudItem>


    </MudGrid>
</MudForm>

